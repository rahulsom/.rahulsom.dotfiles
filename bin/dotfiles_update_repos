#!/bin/bash

padOut() {
  while read -r line; do
    printf "%5s$(tput setaf "${TPUT_Blue}")|$(tput sgr0) %s\n" "" "$line"
  done
}

padErr() {
  while read -r line; do
    printf "%5s$(tput setaf "${TPUT_Red}")|$(tput sgr0) %s\n" "" "$line"
  done
}

testAndPull() {
  test -d .git && git pull
}

while read d; do
  tput bold
  echo -e "$d" | perl -pe "s:$HOME:~:g"
  tput sgr0
  cd "$d" || return
  echo ""
  { testAndPull 2>&1 1>&3 3>&- | padErr; } 3>&1 1>&2 | padOut
  echo ""
done < <(ls -1d "$HOME"/.*dotfiles)
